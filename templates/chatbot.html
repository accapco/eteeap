<div id="chat-widget" class="chat-widget">
    <div class="chat-header">
        <span>Chat with us</span>
        <button id="chat-toggle" onclick="toggleChat()"> __ </button>
    </div>
    <div class="chat-body" id="chat-body">
        <div id="chat-log">
            <div class='bot-response'>How can I assist you with ETEEAP today?</div>
        </div>
        <input type="text" id="message" placeholder="Type your message here..." autocomplete="off" />
        <button id="send" onclick="sendMessage()">Send</button>
    </div>
</div>

<div id="chat-icon" class="chat-icon" onclick="toggleChat()">
    <img src="{{ url_for('static', filename='images/chat-icon.png') }}" alt="Chat" />
</div>

<script>
    function toggleChat() {
        const chatWidget = document.getElementById("chat-widget");
        const chatIcon = document.getElementById("chat-icon");
        if (
            chatWidget.style.display === "none" ||
            chatWidget.style.display === ""
        ) {
            chatWidget.style.display = "block";
            chatIcon.style.display = "none";
        } else {
            chatWidget.style.display = "none";
            chatIcon.style.display = "block";
        }
    }

    const messageField = document.getElementById("message");
    const sendBtn = document.getElementById("send");
    function sendMessage() {
        var message = messageField.value;
        if (message.trim() === "") return;

        const chatLog = document.getElementById("chat-log");
        chatLog.innerHTML += "<div class='user-message'>"+message+"</div>"

        fetch("/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({"query": message})
        })
        .then((response) => response.json())
        .then((data) => {
            chatLog.innerHTML += "<div class='bot-response'>"+data.response+"</div>";
            document.getElementById("message").value = "";
        })
        .catch((error) => {
            console.log(error);
        });
    }

    messageField.addEventListener("keypress", event => {
        if (event.key === "Enter") {
            event.preventDefault();
            sendBtn.click();
        }
    })
</script>